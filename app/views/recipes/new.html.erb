<h1>Create New Recipe</h1>

<%
=begin%>
 TODO: 
 - error handling 
 - saving form state when there is an error (currently if i add ingredients, i have to re-add them)

<%
=end%>

<%=form_with model: @recipe do |form| %>

    <%= form.label :name %>
    <%= form.text_field :name, required: true %>

    <%= form.label :instructions %>
    <%= form.text_area :instructions, size: '50x10', required: true %>

    <div data-controller="nested-form">
        <template data-nested-form-target="template">
            <%= form.fields_for :ingredients, Ingredient.new, child_index: 'NEW_RECORD' do |ingredient_fields| %>
                <%= render "nested_ingredient", form: ingredient_fields %>
            <% end %>
        </template>

        <%= form.fields_for :ingredients, @recipe.ingredients.build do |ingredient_fields| %>
            <%= render "nested_ingredient", form: ingredient_fields %>
         <% end %> 

        <div data-nested-form-target="links">
            <%= link_to "Add Ingredient", "#", data: {action: "click->nested-form#add_association"} %>
        </div>
    </div>

    <%= form.label :ingredients %>
    <%= form.collection_select :ingredients, Ingredient.all, :id, :name, {}, { multiple: true, class: "existing-ingredients" } %> 

    <%= form.submit %>
<% end %>